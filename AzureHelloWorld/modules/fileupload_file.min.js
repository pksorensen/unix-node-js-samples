var fs=require("fs"),path=require("path"),async=require("async"),mime=require("mime"),filesystem=function(){function n(n){this.uploaddir=n,async.waterfall([function(t){fs.stat(n,function(n){t(null,n)})},function(t,i){t&&t.code==="ENOENT"&&fs.mkdir(n,"0755",i)},function(n){if(n){console.log(n);throw n;}}])}return n.prototype.put=function(n,t){var i=this;async.waterfall([function(t){if(typeof n=="string"){var u=mime.lookup(n),r;i.getFileHash(n,function(i,f){if(i)return t(i);fs.stat(n,function(i,e){if(i&&i.code==="ENOENT")return t(i);r=e.size,n=fs.createReadStream(n),n.name=path.basename(n.path),n.type=u,n.size=r,t(null,f)})})}else i.getFileHash(n.path,t)},function(t,r){fs.mkdir(path.join(i.uploaddir,t),"0755",function(){var f=n.path,u=path.join(i.uploaddir,t,n.name);n={size:n.size,type:n.type,path:t+"/",basename:n.name},fs.stat(u,function(t,i){if(t&&t.code==="ENOENT"){var e=fs.createReadStream(f),o=fs.createWriteStream(u,{flags:"w"});e.pipe(o);e.on("end",function(){r(null,n)})}else i&&i.isFile()?r(null,n):r(t)})})}],t)},n.prototype.get=function(){},n.prototype.getAsReadStream=function(){},n.prototype.remove=function(){},n.prototype.getFileHash=function(){},n}();exports.filesystem=filesystem